<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>python进阶 | lpdswing'blogs</title><meta name="description" content="Python 进阶 PEP8 编码规范, 以及开发中的一些惯例和建议  代码编排:  缩进 4 个空格, 禁止空格与 Tab 混用 行长 80: 防止单行逻辑过于复杂   适当添加空行  函数间: 顶级函数间空 2 行, 类的方法之间空 1 行 函数内: 同一函数内的逻辑块之间, 空 1 行 文件结尾: 留一个空行   import  顺序 标准库 第三方库 自定义库   单行不要 import"><meta name="keywords" content="django,python"><meta name="author" content="lpdswing,lpdswing@163.com"><meta name="copyright" content="lpdswing"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="&lt;meta name=&quot;baidu-site-verification&quot; content=&quot;hEWgSayGAD&quot; /&gt;"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="python进阶"><meta name="twitter:description" content="Python 进阶 PEP8 编码规范, 以及开发中的一些惯例和建议  代码编排:  缩进 4 个空格, 禁止空格与 Tab 混用 行长 80: 防止单行逻辑过于复杂   适当添加空行  函数间: 顶级函数间空 2 行, 类的方法之间空 1 行 函数内: 同一函数内的逻辑块之间, 空 1 行 文件结尾: 留一个空行   import  顺序 标准库 第三方库 自定义库   单行不要 import"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="python进阶"><meta property="og:url" content="http://lpdswing.com/2017/05/03/Python%E8%BF%9B%E9%98%B6/"><meta property="og:site_name" content="lpdswing'blogs"><meta property="og:description" content="Python 进阶 PEP8 编码规范, 以及开发中的一些惯例和建议  代码编排:  缩进 4 个空格, 禁止空格与 Tab 混用 行长 80: 防止单行逻辑过于复杂   适当添加空行  函数间: 顶级函数间空 2 行, 类的方法之间空 1 行 函数内: 同一函数内的逻辑块之间, 空 1 行 文件结尾: 留一个空行   import  顺序 标准库 第三方库 自定义库   单行不要 import"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="article:published_time" content="2017-05-03T10:16:36.000Z"><meta property="article:modified_time" content="2020-05-10T11:59:32.048Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://lpdswing.com/2017/05/03/Python%E8%BF%9B%E9%98%B6/"><link rel="prev" title="web基础-zx版" href="http://lpdswing.com/2017/05/03/Web%E5%9F%BA%E7%A1%80/"><link rel="next" title="学习笔记2" href="http://lpdswing.com/2017/05/03/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://lpdswing.com/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">5</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Python-进阶"><span class="toc-number">1.</span> <span class="toc-text">Python 进阶</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">lpdswing'blogs</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">python进阶</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2017-05-03 18:16:36"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2017-05-03</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-05-10 19:59:32"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-05-10</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Django/">Django</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.9k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 12 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Python-进阶"><a href="#Python-进阶" class="headerlink" title="Python 进阶"></a>Python 进阶</h1><ol>
<li><p>PEP8 编码规范, 以及开发中的一些惯例和建议</p>
<ul>
<li><p>代码编排:</p>
<ul>
<li>缩进 4 个空格, 禁止空格与 Tab 混用</li>
<li>行长 80: 防止单行逻辑过于复杂</li>
</ul>
</li>
<li><p>适当添加空行</p>
<ul>
<li>函数间: 顶级函数间空 2 行, 类的方法之间空 1 行</li>
<li>函数内: 同一函数内的逻辑块之间, 空 1 行</li>
<li>文件结尾: 留一个空行</li>
</ul>
</li>
<li><p>import</p>
<ul>
<li>顺序<ol>
<li>标准库</li>
<li>第三方库</li>
<li>自定义库</li>
</ol>
</li>
<li>单行不要 import 多个库</li>
<li>模块内用不到的不要去 import</li>
</ul>
</li>
<li><p>空格</p>
</li>
<li><p>注释</p>
<ul>
<li>行注释</li>
<li>块注释</li>
<li>引入外来算法或者配置时须在注释中添加源连接, 标明出处</li>
<li>函数和类尽可能添加 <code>docstring</code></li>
</ul>
</li>
<li><p>命名</p>
<ul>
<li>包名、模块名、函数名、方法名全部使用小写, 单词间用下划线连接</li>
<li>类名、异常名使用 CapWords 的方式, 异常名结尾加 <code>Error</code> 或 <code>Wraning</code> 后缀</li>
<li>全局变量尽量使用大写, 一组同类型的全局变量要加上统一前缀, 单词用下划线连接</li>
</ul>
</li>
<li><p>字符串拼接尽量使用 <code>join</code> 方式: 速度快, 内存消耗小</p>
</li>
<li><p>语意明确、直白</p>
<ul>
<li><code>not xx in yy</code> vs <code>xx not in yy</code></li>
<li><code>not a is b</code> vs <code>a is not b</code></li>
</ul>
</li>
<li><p>程序构建</p>
<ul>
<li>一个函数只做一件事情, 并把这件事做好</li>
<li>大的功能用小函数之间灵活组合来完成</li>
<li>避免编写庞大的程序, “大”意味着体积庞大, 逻辑复杂甚至混乱</li>
</ul>
</li>
<li><p>函数名必须有动词, 最好是 do_something 的句式, 或者 somebody_do_something 句式</p>
</li>
<li><p>自定义的变量名、函数名不要与标准库中的名字冲突</p>
</li>
<li><p>pip install pep8</p>
</li>
<li><p>练习: 规范化这段代码</p>
<pre><code>from django.conf import settings
import sys, os
mod=0xffffffff
def foo ( a , b = 123 ) :
    c = { 'x' : 111 , 'y' : 222 }  # 定义一个字典
    d = [ 1, 3 , 5 ]
    return a , b , c
def bar(x):
    if x%2 ==0: return true</code></pre></li>
</ul>
</li>
<li><p><code>*</code> 和 <code>**</code> 的用法</p>
<ul>
<li><p>函数定义</p>
<pre><code>def foo(*args, **kwargs):
    pass</code></pre></li>
<li><p>参数传递</p>
<pre><code>def foo(x, y, z, a, b):
    print(x)
    print(y)
    print(z)
    print(a)
    print(b)
lst = [1, 2, 3]
dic = {'a': 22, 'b': 77}
foo(*lst, **dic)</code></pre></li>
<li><p>强制命名参数</p>
<pre><code>def foo(a, *, b, c=123):
    pass</code></pre></li>
<li><p>解包语法: <code>a, b, *ignored, c = [1, 2, 3, 4, 5, 6, 7]</code></p>
</li>
</ul>
</li>
<li><p>Python 的赋值和引用</p>
<ul>
<li><p><code>==, is</code>: <code>==</code> 判断的是值, <code>is</code> 判断的是内存地址 (即对象的id)</p>
</li>
<li><p>小整数对象: [-5, 256]</p>
</li>
<li><p><code>copy, deepcopy</code> 的区别</p>
<ul>
<li><code>copy</code>: 只拷贝表层元素</li>
<li><code>deepcopy</code>: 在内存中重新创建所有子元素</li>
<li><img src="/image/Copy.png" alt="copy and deepcopy"></li>
</ul>
</li>
<li><p>练习1: 说出执行结果</p>
<pre><code>def extendList(val, lst=[]):
    lst.append(val)
    return lst

list1 = extendList(10)
list2 = extendList(123, [])
list3 = extendList('a')</code></pre></li>
<li><p>练习2: 说出下面执行结果</p>
<pre><code>from copy import copy, deepcopy
from pickle import dumps, loads

a = [1, 2, 3]
b = [a] * 3
c = copy(b)
d = deepcopy(b)
e = loads(dumps(b, 4))

b[1].append(999)
c[1].append(999)
d[1].append(999)
e[1].append(999)
d[1].append(777)
e[1].append(777)</code></pre></li>
<li><p>自定义 deepcopy: <code>my_deepcopy = lambda item: loads(dumps(item, 4))</code></p>
</li>
</ul>
</li>
<li><p>迭代器, 生成器, itertools, yield, 列表 / 字典 / 集合的推导</p>
<pre><code>class Range:
    def __init__(self, start, end):
        self.start = start - 1
        self.end = end

    def __iter__(self):
        return self

    def __next__(self):
        self.start += 1
        if self.start &lt; self.end:
            return self.start
        else:
            raise StopIteration()</code></pre><ul>
<li><p>iterator: 任何实现了 <code>__iter__</code> 和 <code>__next__</code> (python2中是 <code>next()</code>) 方法的对象都是迭代器.</p>
<ul>
<li><code>__iter__</code>返回迭代器自身</li>
<li><code>__next__</code> 返回容器中的下一个值</li>
<li>如果容器中没有更多元素, 则抛出StopIteration异常</li>
</ul>
</li>
<li><p>generator: 生成器其实是一种特殊的迭代器, 不需要自定义 <code>__iter__</code> 和 <code>__next__</code></p>
<ul>
<li>生成器函数 (yield)</li>
<li>生成器表达式</li>
</ul>
</li>
<li><p>练习1: 自定义一个迭代器, 实现斐波那契数列</p>
<pre><code>class Fib:
    def __init__(self, count):
        self.prev = 0
        self.curr = 1
        self.count = count

    def __iter__(self):
        return self

    def __next__(self):
        if self.count &gt; 0:
            # 计数
            self.count -= 1
            # 计算当前的值
            current = self.curr
            # 为下次做准备
            self.prev, self.curr = self.curr, (self.curr + self.prev)
            # 返回当前值
            return current
        else:
            raise StopIteration()</code></pre></li>
<li><p>练习2: 自定义一个生成器函数, 实现斐波那契数列</p>
<pre><code>def fib(max_value):
    prev = 0
    curr = 1
    while curr &lt; max_value:
        yield curr
        prev, curr = curr, curr + prev</code></pre></li>
<li><p>练习3: 定义一个随机数迭代器, 随机范围为 [1, 50], 最大迭代次数 30</p>
<pre><code>import random

class RandomIter:
    def __init__(self, start, end, times):
        self.start = start
        self.end = end
        self.max_times = times
        self.count = 0

    def __iter__(self):
        return self

    def __next__(self):
        self.count += 1
        if self.count &lt;= self.max_times:
            return random.randint(self.start, self.end)
        else:
            raise StopIteration()</code></pre></li>
<li><p>迭代器、生成器有什么好处？</p>
<ul>
<li>节省内存</li>
<li>惰性求值</li>
</ul>
</li>
<li><p>itertools</p>
<ul>
<li>无限迭代<ul>
<li><code>count(start=0, step=1)</code></li>
<li><code>cycle(iterable)</code></li>
<li><code>repeat(object [,times])</code></li>
</ul>
</li>
<li>有限迭代<ul>
<li><code>chain(*iterables)</code></li>
</ul>
</li>
<li>排列组合<ul>
<li><code>product(*iterables, repeat=1)</code> 笛卡尔积</li>
<li><code>permutations(iterable[, r-length])</code> 全排列</li>
<li><code>combinations(iterable, r-length)</code> 组合</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ol start="4">
<li><p><code>method</code>, <code>classmethod</code> 和 <code>staticmethod</code></p>
<ul>
<li><p><code>method</code>: 通过实例调用时, 可以引用类内部的任何属性和方法</p>
</li>
<li><p><code>classmethod</code>: 无需实例化, 可以调用类属性和类方法, 无法取到普通的成员属性和方法</p>
</li>
<li><p><code>staticmethod</code>: 无论用类调用还是用实例调用, 都无法取到类内部的属性和方法, 完全独立的一个方法</p>
</li>
<li><p>练习: 说出下面代码的运行结果</p>
<pre><code>class Test(object):
    x = 123

    def __init__(self):
        self.y = 456

    def bar1(self):
        print('i am a method')

    @classmethod
    def bar2(cls):
        print('i am a classmethod')

    @staticmethod
    def bar3():
        print('i am a staticmethod')

    def foo1(self):
        print(self.x)
        print(self.y)
        self.bar1()
        self.bar2()
        self.bar3()

    @classmethod
    def foo2(cls):
        print(cls.x)
        # print(cls.y)
        # cls.bar1()
        Test.bar2()
        Test.bar3()

    @staticmethod
    def foo3(obj):
        print(obj.x)
        print(obj.y)
        obj.bar1()
        obj.bar2()
        obj.bar3()

t = Test()
t.foo1()
t.foo2()
t.foo3()</code></pre></li>
</ul>
</li>
<li><p>Python 魔术方法</p>
<ol>
<li><p><code>__str__</code>, <code>__repr__</code></p>
</li>
<li><p><code>__init__</code> 和 <code>__new__</code></p>
<ul>
<li><p><code>__new__</code> 返回一个对象的实例, <code>__init__</code> 无返回值</p>
</li>
<li><p><code>__new__</code> 是一个类方法</p>
<ul>
<li><p>单例模式</p>
<pre><code>class A(object):
    '''单例模式'''
    obj = None
    def __new__(cls, *args, **kwargs):
        if cls.obj is None:
            cls.obj = object.__new__(cls)
        return cls.obj</code></pre></li>
</ul>
</li>
</ul>
</li>
<li><p>比较运算、数学运算</p>
<ul>
<li><p>运算符重载</p>
<ul>
<li><code>+</code>: <code>__add__(value)</code></li>
<li><code>-</code>: <code>__sub__(value)</code></li>
<li><code>*</code>: <code>__mul__(value)</code></li>
<li><code>/</code>: <code>__truediv__(value)</code> (Python 3.x), <code>__div__(value)</code> (Python 2.x)</li>
<li><code>//</code>: <code>__floordiv__(value)</code></li>
<li><code>%</code>: <code>__mod__(value)</code></li>
<li><code>&amp;</code>: <code>__and__(value)</code></li>
<li><code>|</code>: <code>__or__(value)</code></li>
</ul>
</li>
<li><p>练习: 实现字典的 <code>__add__</code> 方法, 作用相当于 d.update(other)</p>
<pre><code>class Dict(dict):
    def __add__(self, other):
        if isinstance(other, dict):
            new_dict = {}
            new_dict.update(self)
            new_dict.update(other)
            return new_dict
        else:
            raise TypeError('not a dict')</code></pre></li>
<li><p>比较运算符的重载</p>
<ul>
<li><code>==</code>: <code>__eq__</code></li>
<li><code>!=</code>: <code>__ne__</code></li>
<li><code>&gt;</code>: <code>__gt__</code></li>
<li><code>&gt;=</code>: <code>__ge__</code></li>
<li><code>&lt;</code>: <code>__lt__</code></li>
<li><code>&lt;=</code>: <code>__le__</code></li>
</ul>
</li>
<li><p>练习: 完成一个类, 实现数学上无穷大的概念</p>
<pre><code>class Inf:
    def __lt__(self, other):
        return False
    def __le__(self, other):
        return False
    def __ge__(self, other):
        return True
    def __gt__(self, other):
        return True
    def __eq__(self, other):
        return False
    def __ne__(self, other):
        return True</code></pre></li>
</ul>
</li>
<li><p>容器方法</p>
<ul>
<li><p><code>__len__, __iter__, __contains__</code></p>
</li>
<li><p><code>__getitem__</code> 对 <code>string, list, tuple, dict</code> 有效</p>
</li>
<li><p><code>__setitem__</code> 对 <code>list, dict</code> 有效</p>
</li>
<li><p><code>__missing__</code> 对 <code>dict</code> 有效</p>
<pre><code>class Dict(dict):
    def __missing__(self, key):
        self[key] = None  # 当检查到 Key 缺失时, 可以做任何默认行为</code></pre></li>
</ul>
</li>
<li><p>可执行对象: <code>__call__</code></p>
</li>
<li><p>with:</p>
<ul>
<li><code>__enter__</code> 进入 <code>with</code> 代码块前的准备操作</li>
<li><code>__exit__</code> 退出时的善后操作</li>
</ul>
</li>
<li><p><code>__setattr__, __getattribute__, __getattr__, __dict__</code></p>
<ul>
<li><p>常用来做属性监听</p>
<pre><code>class A:
    '''TestClass'''
    z = [7,8,9]
    def __init__(self):
        self.x = 123
        self.y = 'abc'

    def __setattr__(self, name, value):
        print('set %s to %s' % (name, value))
        object.__setattr__(self, name, value)

    def __getattribute__(self, name):
        print('get %s' % name)
        return object.__getattribute__(self, name)

    def __getattr__(self, name):
        print('not has %s' % name)
        return -1

    def foo(self, x, y):
        return x ** y

# 对比
a = A()
print(A.__dict__)
print(a.__dict__)</code></pre></li>
</ul>
</li>
<li><p>描述器: <code>__set__, __get__</code></p>
<ul>
<li><a href="http://pyzh.readthedocs.io/en/latest/Descriptor-HOW-TO-Guide.html" target="_blank" rel="noopener">http://pyzh.readthedocs.io/en/latest/Descriptor-HOW-TO-Guide.html</a></li>
<li>常见应用场景: ORM 的各种 Field 类</li>
</ul>
</li>
<li><p>槽: <code>__slots__</code></p>
<ul>
<li><p>固定类所具有的属性</p>
</li>
<li><p>实例不会分配 <code>__dict__</code></p>
</li>
<li><p>实例无法动态添加属性</p>
</li>
<li><p>优化内存分配</p>
<pre><code>class A:
    __slots__ = ('x', 'y')</code></pre></li>
</ul>
</li>
</ol>
</li>
<li><p>Python 性能之困</p>
<ol>
<li>计算密集型<ul>
<li>CPU 长时间满负荷运行, 如图像处理、大数据运算、圆周率计算等</li>
<li>计算密集型: 用 C 语言补充</li>
<li>Profile, timeit</li>
</ul>
</li>
<li>I/O 密集型: 网络 IO, 文件 IO, 设备 IO 等<ul>
<li>多线程 / 多进程 / 协程</li>
<li>阻塞 -&gt; 非阻塞</li>
<li>同步 -&gt; 异步</li>
</ul>
</li>
<li>GIL 全局解释器锁<ul>
<li>它确保任何时候都只有一个Python线程执行。<br><img src="/image/GIL.png" alt="GIL" title="GIL"></li>
</ul>
</li>
<li>什么是进程、线程、协程？<ul>
<li>进程: 资源消耗大, 系统整体开销大, 数据通信不方便</li>
<li>线程: 资源消耗小, 可共享数据。上下文开销大。按时间片强制切换, 不够灵活</li>
<li>协程: 内存开销更小, 上下文切换开销更小。可根据事件切换, 更加有效的利用 CPU</li>
</ul>
</li>
<li>什么是同步、异步、阻塞、非阻塞？<ul>
<li>同步, 异步: 客户端调用服务器接口时</li>
<li>阻塞, 非阻塞: 服务端发生等待</li>
</ul>
</li>
<li>事件驱动 + 多路复用<ul>
<li>轮询: select, poll</li>
<li>事件驱动: epoll 有效轮询</li>
</ul>
</li>
<li>Greenlets / gevent | tornado / asyncio</li>
<li>线程安全, 锁<ul>
<li>获得锁之后, 一定要释放, 避免死锁</li>
<li>获得锁之后, 执行的语句, 只跟被锁资源有关</li>
<li>区分普通锁 Lock, 可重入锁 RLock</li>
<li>线程之间的数据交互尽量使用 Queue</li>
</ul>
</li>
<li>gevent<ul>
<li>monkey.patch</li>
<li>gevent.sleep 非阻塞式等待</li>
<li>Queue 协程间数据交互, 避免竞争</li>
</ul>
</li>
</ol>
</li>
<li><p>装饰器</p>
<ul>
<li><p>最简装饰器</p>
<pre><code>def deco(func):
    def wrap(*args, **kwargs):
        return func(*args, **kwargs)
    return wrap

@deco
def foo(a, b):
    return a ** b</code></pre></li>
<li><p>原理</p>
<ul>
<li><p>对比被装饰前后的 <code>foo.__name__</code> 和 <code>foo.__doc__</code></p>
<pre><code>from functools import wraps
def deco(func):
    '''i am deco'''
    @wraps(func)
    def wrap(*args, **kwargs):
        '''i am wrap'''
        return func(*args, **kwargs)
    return wrap</code></pre></li>
<li><p>简单过程</p>
<pre><code>fn = deco(func)
fn(*args, **kwargs)</code></pre></li>
<li><p>多个装饰器调用过程</p>
<pre><code>@deco1
@deco2
@deco3
def foo(x, y):
    return x ** y</code></pre></li>
</ul>
</li>
<li><p>带参数的装饰器</p>
<pre><code>def deco(n):
    def wrap1(func):
        def wrap2(*args, **kwargs):
            return func(*args, **kwargs)
        return wrap2
    return wrap1</code></pre></li>
<li><p>装饰器类和 <code>__call__</code></p>
</li>
<li><p>使用场景</p>
<ul>
<li>参数、结果检查</li>
<li>缓存、计数</li>
<li>日志、统计</li>
<li>权限管理</li>
<li>重试</li>
<li>其他</li>
</ul>
</li>
<li><p>练习1：写一个 timer 装饰器, 计算出被装饰函数调用一次花多长时间, 并把时间打印出来</p>
</li>
<li><p>练习2: 写一个权限管理装饰器, 权限分为 <code>admin / member / guest</code> 三级</p>
</li>
<li><p>练习3: 写一个 Retry 装饰器</p>
<pre><code>import time

class retry(object):
    def __init__(self, max_retries=3, wait=0, exceptions=(Exception,)):
        self.max_retries = max_retries
        self.exceptions = exceptions
        self.wait = wait

    def __call__(self, f):
        def wrapper(*args, **kwargs):
            for i in range(self.max_retries + 1):
                try:
                    result = f(*args, **kwargs)
                except self.exceptions:
                    time.sleep(self.wait)
                    continue
                else:
                    return result
        return wrapper</code></pre></li>
</ul>
</li>
<li><p>闭包</p>
<ul>
<li><p>说出下面函数返回值</p>
<pre><code>def foo():
    l = []
    def bar(i):
        l.append(i)
        return l
    return bar

f1 = foo()
f2 = foo()

# 说出下列语句执行结果
f1(1)
f1(2)
f2(3)</code></pre></li>
<li><p>作用域</p>
<ul>
<li><p>global</p>
</li>
<li><p>nonlocal</p>
</li>
<li><p>globals()</p>
</li>
<li><p>locals()</p>
</li>
<li><p>vars()</p>
<pre><code>local namespace
    |
    V
global namespace
    |
    V
builtin namespace</code></pre></li>
</ul>
</li>
<li><p>更深入一点: <code>__closure__</code></p>
</li>
</ul>
</li>
<li><p>Garbage Collection (GC)</p>
<ul>
<li><p>引用计数</p>
<ul>
<li><p>优点: 简单、实时性高</p>
</li>
<li><p>缺点: 消耗资源、循环引用</p>
<pre><code>l1, l2 = [], []
l1.append(l2)
l2.append(l1)</code></pre><p><img src="/image/GC.png" alt="GC"></p>
</li>
</ul>
</li>
<li><p>标记-清除, 分代收集</p>
</li>
</ul>
</li>
<li><p>继承、多继承、多态、Mixin、super</p>
<ul>
<li><p>继承</p>
</li>
<li><p>多态</p>
</li>
<li><p>多继承 和 Mixin</p>
</li>
<li><p>super</p>
<pre><code>class A:
    def __init__(self):
        print('enter A')
        self.x = 111
        print('exit A')</code></pre></li>
</ul>
</li>
</ol>
<pre><code>class B(A):
    def __init__(self):
        print('enter B')
        A.__init__(self)
        # super().__init__()
        print('exit B')


class C(A):
    def __init__(self):
        print('enter C')
        A.__init__(self)
        # super().__init__()
        print('exit C')


class D(B, C):
    def __init__(self):
        print('enter D')
        B.__init__(self)
        C.__init__(self)
        # super().__init__()
        print('exit D')

d = D()</code></pre><ol start="11">
<li><p>一些技巧和误区</p>
<ol>
<li><p>格式化打印</p>
<ul>
<li>json.dumps(obj, indent=4)</li>
<li>json 压缩: <code>json.dumps(obj, separators=[',',':'])</code></li>
<li>pprint</li>
</ul>
</li>
<li><p>确保能取到有效值</p>
<ul>
<li><code>d.get(k, default)</code></li>
<li><code>d.setdefault</code></li>
<li><code>defaultdict</code></li>
<li><code>a or b</code></li>
<li><code>x = a if foo() else b</code></li>
</ul>
</li>
<li><p>try…except… 的滥用</p>
<ul>
<li>不要把所有东西全都包住, 程序错误需要报出来</li>
<li>使用 <code>try...except</code> 要指明具体错误, <code>try</code> 结构不是用来隐藏错误的, 而是用来有方向的处理错误的</li>
</ul>
</li>
<li><p>利用 dict 做模式匹配</p>
<pre><code>def do1():
    print('i am do1')

def do2():
    print('i am do2')

def do3():
    print('i am do3')

def do4():
    print('i am do4')

mapping = {1: do1, 2: do2, 3: do3, 4: do4}
mod = random.randint(1, 10)
func = mapping.get(mod, do4)
func()</code></pre></li>
<li><p><code>inf, -inf, nan</code></p>
</li>
<li><p>pyenv, venv, 命名空间</p>
<ul>
<li><a href="https://github.com/pyenv/pyenv-installer" target="_blank" rel="noopener">pyenv</a>: 管理 Python 版本</li>
<li>venv: 创建虚拟环境, 做环境隔离, venv 目录直接放到项目的目录里</li>
</ul>
</li>
<li><p>property: 把一个方法属性化</p>
<pre><code>class C(object):
    @property
    def x(self):
        "I am the 'x' property."
        return self._x
    @x.setter
    def x(self, value):
        self._x = value
    @x.deleter
    def x(self):
        del self._x</code></pre></li>
<li><p>else 子句: <code>if, for, while, try</code></p>
</li>
<li><p>collections 模块</p>
<ul>
<li>defaultdict</li>
<li>namedtuple</li>
<li>Counter</li>
</ul>
</li>
</ol>
</li>
</ol>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:lpdswing@163.com">lpdswing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lpdswing.com/2017/05/03/Python%E8%BF%9B%E9%98%B6/">http://lpdswing.com/2017/05/03/Python进阶/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lpdswing.com" target="_blank">lpdswing'blogs</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/django/">django</a><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2017/05/03/Web%E5%9F%BA%E7%A1%80/"><img class="prev_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">web基础-zx版</div></div></a></div><div class="next-post pull_right"><a href="/2017/05/03/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/"><img class="next_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">学习笔记2</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2017/05/03/Web基础/" title="web基础-zx版"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-05-03</div><div class="relatedPosts_title">web基础-zx版</div></div></a></div><div class="relatedPosts_item"><a href="/2017/05/03/django进阶-web基础/" title="web基础"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-05-03</div><div class="relatedPosts_title">web基础</div></div></a></div><div class="relatedPosts_item"><a href="/2017/05/03/学习笔记/" title="学习笔记"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-05-03</div><div class="relatedPosts_title">学习笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2017/05/03/学习笔记2/" title="学习笔记2"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-05-03</div><div class="relatedPosts_title">学习笔记2</div></div></a></div><div class="relatedPosts_item"><a href="/2017/05/03/django进阶-中间件/" title="django进阶"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-05-03</div><div class="relatedPosts_title">django进阶</div></div></a></div><div class="relatedPosts_item"><a href="/2017/05/03/Django进阶/" title="django进阶-zx版"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-05-03</div><div class="relatedPosts_title">django进阶-zx版</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '280881e58e5f41e83c41',
  clientSecret: '5f4418b28b39b7f5c0cc3d1d7849d123690b8e6d',
  repo: 'hexo-gtalk',
  owner: 'lpdswing',
  admin: ['lpdswing'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By lpdswing</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/local-search.js"></script></body></html>